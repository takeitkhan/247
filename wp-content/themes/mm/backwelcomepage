<?php
/* Template Name: Welcome Page */
get_header();
?>
<div class="position-relative" style="height: 100vh; overflow: hidden;">
    <?php $hero_img = get_theme_mod('hero_image');
    if ($hero_img): ?>
        <img src="<?php echo esc_url($hero_img); ?>" alt="Chess Empowerment" class="w-100 h-100 object-fit-cover" />
    <?php endif; ?>

    <div class="top-0 position-absolute">
        <!-- <h1 class="text-center font-bold mx-auto <?php echo esc_attr(get_theme_mod('hero_font_size_classes', 'fs-giant fs-md-2 fs-sm-4')); ?> 
            <?php //echo esc_attr(get_theme_mod('hero_extra_classes', 'lh-base text-shadow-lg w-75')); ?> custom-padding-top">            
        </h1> -->
        <div class="mx-auto w-75 custom_padding_bottom">
            <?php echo wp_kses_post(get_theme_mod('hero_text_content')); ?>
        </div>
        <style>
            .custom_padding_bottom p {
                margin-bottom: 5px; /* Remove bottom margin */
            }
        </style>


        <div class="my-5 container-fluid">
            <ul class="nav nav-tabs fs-6" id="homeTab" role="tablist">
                <?php
                // Query to get the tabs
                $tabs_query = new WP_Query(array(
                    'post_type' => 'tab',
                    'posts_per_page' => -1,
                    'orderby' => 'menu_order',
                    'order' => 'ASC'
                ));

                if ($tabs_query->have_posts()) :
                    $active_class = 'active'; // To add the active class to the first tab
                    while ($tabs_query->have_posts()) : $tabs_query->the_post();
                        // Get the custom fields
                        $tab_title = get_the_title();
                ?>
                        <li class="nav-item" role="presentation">
                            <button class="custom-tab-button <?php echo $active_class; ?>" id="<?php echo sanitize_title($tab_title); ?>-tab" data-bs-toggle="tab" data-bs-target="#<?php echo sanitize_title($tab_title); ?>" type="button" role="tab" aria-controls="<?php echo sanitize_title($tab_title); ?>" aria-selected="true"><?php echo esc_html($tab_title); ?></button>
                        </li>
                <?php
                        $active_class = ''; // After the first tab, no need to add "active"
                    endwhile;
                endif;
                ?>
            </ul>

            <div class="p-3 text-left tab-content transparent-bg" id="homeTabContent">
                <?php
                // Reset the loop to fetch the content for each tab
                if ($tabs_query->have_posts()) :
                    $active_class = 'show active'; // To add the active class to the first tab content
                    while ($tabs_query->have_posts()) : $tabs_query->the_post();
                        // Get the custom fields
                        $tab_title = get_the_title();
                        $tab_content = get_the_content(); // Get the raw content

                        // Allow specific tags like <p>, <br>, etc.
                        $allowed_tags = array(
                            'p' => array(),
                            'br' => array(),
                            'strong' => array(),
                            'em' => array(),
                            'ul' => array(),
                            'ol' => array(),
                            'li' => array(),
                            'blockquote' => array(),
                        );
                        $tab_content = wp_kses($tab_content, $allowed_tags);
                ?>
                        <div class="tab-pane fade <?php echo $active_class; ?>" id="<?php echo sanitize_title($tab_title); ?>" role="tabpanel" aria-labelledby="<?php echo sanitize_title($tab_title); ?>-tab">
                            <div><?php echo wp_kses_post($tab_content); ?></div>
                        </div>
                <?php
                        $active_class = ''; // After the first tab content, no need to add "show active"
                    endwhile;
                endif;
                ?>
            </div>
        </div>
    </div>

</div>

<div class="container-fluid">
    <div class="px-2 py-4 row">
        <?php while (have_posts()): the_post(); ?>

            <?php
            // Check if the 'hide_title' custom field is checked
            $hide_title = get_post_meta(get_the_ID(), 'hide_title', true);
            ?>
            <div class="col-12">
                <?php the_content(); ?>
            </div>


        <?php endwhile; ?>
    </div>
</div>

<?php get_footer(); ?>